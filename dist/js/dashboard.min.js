angular.module("RDash",["ui.bootstrap","ui.router","ngCookies"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("index",{url:"/",templateUrl:"templates/dashboard.html"}).state("tables",{url:"/tables",templateUrl:"templates/tables.html"}).state("party",{url:"/party/:id",templateUrl:"templates/party.html",controller:"PartyCtrl"})}]).run(["$rootScope","KonfettiApi",function(t,e){t.logout=function(){e.logout(),e.modalAlert("OK logged out. Please close browser window now.",function(){window.close()})}}]);
function AlertsCtrl(l){l.alerts=[],l.addAlert=function(){l.alerts.push({msg:"Another alert!"})},l.closeAlert=function(t){l.alerts.splice(t,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function MasterCtrl(t,e,n){var r={numberOfUsers:"?",numberOfParties:"?",numberOfKonfetti:"?",numberOfTasks:"?"};t.data=JSON.parse(JSON.stringify(r));var o=992;t.getWidth=function(){return window.innerWidth},t.$watch(t.getWidth,function(n,r){n>=o?angular.isDefined(e.get("toggle"))?t.toggle=!!e.get("toggle"):t.toggle=!0:t.toggle=!1}),t.toggleSidebar=function(){t.toggle=!t.toggle,e.put("toggle",t.toggle)},window.onresize=function(){t.$apply()},t.refreshData=function(){n.loadDashBoardInfo(function(e){t.data=e},function(){n.modalAlert("Getting Data failed. Check internet connection. Try later."),t.data=JSON.parse(JSON.stringify(r))})},t.refreshData()}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","KonfettiApi",MasterCtrl]);
function PartyCtrl(t,e,n){t.geoMatchingEnabled=!0,t.partyID=0,t.saveButtonDisabled="disabled",t.freshParty={id:0,name:"",detailText:"",contact:"",reviewLevel:0,visibility:0,newRequestMinKonfetti:1,welcomeBalance:0,lat:0,lon:0,meters:0,sendKonfettiMode:0,sendKonfettiWhiteList:[],sendKonfettiWhiteListCSV:""},t.party=JSON.parse(JSON.stringify(t.freshParty)),t.$watchCollection("party",function(e,n){JSON.stringify(e)!=JSON.stringify(n)&&(t.saveButtonDisabled="active")}),t.reviewOptions=[{id:0,name:"NONE - no review process, all tasks are public by posting"},{id:1,name:"TASKS - review on initial task creation, but user is free to post any additional info later"},{id:2,name:"EVERYTHING - all content visible to the public needs to get thru review process"}],t.typeOptions=[{id:0,name:"PUBLIC - for everybody to see an join"},{id:1,name:"PRIVATE - for everybody to see but needs invitation code to join"},{id:2,name:"HIDDEN - can just be seen and joined by invitation code"}],t.spendOptions=[{id:0,name:"DEACTIVATED - for everybody to see an join"},{id:2,name:"JUST EARNED - only the konfetti someone earned doing a task can be transfered"},{id:1,name:"ALL - all konfetti can be transfered between users"}],t.partyWhitelistArray2CSV=function(){"undefined"!=typeof t.party.sendKonfettiWhiteList&&null!=typeof t.party.sendKonfettiWhiteList?t.party.sendKonfettiWhiteListCSV=t.party.sendKonfettiWhiteList.join(", "):alert("NO WL")},"undefined"!=typeof e.id&&(t.partyID=e.id,"undefined"==typeof t.partyID||null==t.partyID||0==t.partyID?console.log("no need to load user ..."):n.loadParty(t.partyID,function(e){t.party=e,t.partyWhitelistArray2CSV()},function(){alert("FAIL load party "+t.partyID),t.partyID=0})),t.buttonNewParty=function(){t.party=JSON.parse(JSON.stringify(t.freshParty)),t.saveButtonDisabled="disabled",n.modalAlert("OK. Fill out form & the click 'Create Party'")},t.buttonGenerateAdminCodes=function(){var e=null,a=null,i=function(){alert("ADMIN CODES: "+JSON.stringify(e)+" REVIEW CODES: "+JSON.stringify(a))};n.generateCodes(t.partyID,3,"admin",function(t){e=t,null!=a&&i()},function(){alert("FAILED Admin codes")}),n.generateCodes(t.partyID,10,"review",function(t){a=t,null!=e&&i()},function(){alert("FAILED Review codes")})},t.buttonDeleteAdminCodes=function(){alert("TODO: buttonDeleteAdminCodes")},t.generateKonfetti=function(){n.generateKonfetti(t.partyID,10,100,function(t){alert(JSON.stringify(t))},function(){alert("generateKonfetti FAILED")})},t.inputsAreValid=function(){if(t.party.name.length<3||t.party.name.length>25)return n.modalAlert("Name needs to be between 3 and 20 chars."),!1;if(0==t.party.detailText.length)return n.modalAlert("Please enter any editorial or general info about party."),!1;if(0==t.party.contact.length)return n.modalAlert("Contact is missing"),!1;if(!(t.party.contact.indexOf("@")>0||0==t.party.contact.indexOf("http")))return n.modalAlert("Contact needs to be a email or an link to a website (starts with http:// or https://)."),!1;if(t.party.newRequestMinKonfetti<0)return alert("Minimum konfetti on task creation cannot be negative."),!1;if(t.party.welcomeBalance<0)return n.modalAlert("Welcome konfetti cannot be negative."),!1;if(console.dir(t.geoMatchingEnabled),t.geoMatchingEnabled&&2!=t.party.visibility){if(t.party.meters<0)return n.modalAlert("Radius cannot be negative."),!1;if(0==t.party.meters)return n.modalAlert("Radius needs to be bigger than 0."),!1;if(t.party.lat<-90||t.party.lat>90)return n.modalAlert("Latitude not between -90 and +90 "),!1;if(t.party.lon<-180||t.party.lon>180)return n.modalAlert("Longitude not between -180 and +180 "),!1;if(0==t.party.lon&&0==t.party.lat)return n.modalAlert("Please set Latitude/Longitude as center of your area or deactivated area matching."),!1}else t.party.lat=0,t.party.lon=0,t.party.meters=0;if(t.party.sendKonfettiWhiteListCSV=t.party.sendKonfettiWhiteListCSV.trim(),t.party.sendKonfettiWhiteListCSV.length>0){t.party.sendKonfettiWhiteList=t.party.sendKonfettiWhiteListCSV.split(",");for(var e=0;e<t.party.sendKonfettiWhiteList.length;e++)t.party.sendKonfettiWhiteList[e]=t.party.sendKonfettiWhiteList[e].trim()}return!0},t.saveParty=function(e){t.geoMatchingEnabled=e,t.inputsAreValid()&&(0==t.party.id?n.createParty(t.party,function(e){t.party=e,t.partyWhitelistArray2CSV(),t.saveButtonDisabled="disabled",n.modalAlert("The Party got created and is online.",function(){n.modalAlert("Now create PARTY-ADMIN CODES and send with info material to the party editorial admin - see the new options at the top.")})},function(){n.modalAlert("FAIL. Was not able to create party.")}):n.updateParty(t.party,function(e){n.modalAlert("OK. Updates stored in party."),t.party=e,t.partyWhitelistArray2CSV()},function(){n.modalAlert("FAIL. Was not able to update party.")}),t.saveButtonDisabled="disabled")},t.buttonDeleteParty=function(){n.deleteParty(t.party,function(){n.modalAlert("OK. Party '"+t.party.id+"' was deleted."),t.party=JSON.parse(JSON.stringify(t.freshParty))},function(){n.modalAlert("FAIL. Was not able to delete party.")})}}angular.module("RDash").controller("PartyCtrl",["$scope","$stateParams","KonfettiApi",PartyCtrl]);
function TablesCtrl(i,t,e){i.parties=[],i.users=[],i.getTypeInfo=function(i){return 0==i.visibility?"public":1==i.visibility?"private/listed":2==i.visibility?"private":i.visibility==-1?"deactivated":"-"},i.editParty=function(i){e.path("/party/"+i)},i.optionsUser=function(i){alert("TODO: Give Options on User("+i+")")},i.refreshParties=function(){i.parties=null,t.loadAllParties(function(t){i.parties=t},function(){alert("FAIL loading parties")})},i.refreshUsers=function(){i.users=null,t.loadAllUsers(function(t){i.users=t,console.log("OK USERS:"),console.dir(t)},function(){alert("FAIL loading users")})}}angular.module("RDash").controller("TablesCtrl",["$scope","KonfettiApi","$location",TablesCtrl]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);
function KonfettiApi(n,t){var o="http://fourcores2016.cloudapp.net:9000/konfetti/api",i="https://konfetti-prod.testserver.de/konfetti/api",a=o;if(0!=i.indexOf("https"))return alert("SECURITY EXCEPTION: PRODUCTION API NEEDS TO RUN ON HTTPS !!"),{};var e="",u=function(n){if(""!=e)return void n();var o=t.open({animation:!0,backdrop:"static",template:'<div style="width: 200px;margin: 12px;">Backend Admin Password: <input ng-model="password" type="password" style="margin-top: 10px;" onkeypress="(window.event.charCode==13)?document.getElementById(\'login\').click():void(0);"/><button ng-click="setPassword(password)" id="login" type="button" class="btn btn-primary btn-md" style="margin-top:12px;">Login</button></div>',size:"sm",controller:["$scope",function(t){t.password="",t.setPassword=function(t){""!=t&&(e=t,o.close(),n())}}]})},c=function(n,o){var i=t.open({animation:!0,template:'<div style="width: 280px; margin: 12px;padding: 8px;">'+n+'<br><button ng-click="close()" type="button" class="btn btn-primary btn-md" style="margin-top:12px;">OK</button></div>',size:"sm",controller:["$scope",function(n){n.close=function(n){i.close(),"undefined"!=typeof o&&o()}}]})},r=function(){var n={timeout:6e3,cache:!1,headers:{"X-ADMIN-PASSWORD":e+""}};return n},f=function(n){return"undefined"!=typeof n&&null!=n&&"undefined"!=typeof n.data&&null!=n.data&&"undefined"!=typeof n.data.message&&null!=n.data.message&&0==n.data.message.indexOf("FAIL-PASSWORD")&&(e="",!0)};return{isRunningDevelopmentServer:function(){return i!=a},loadDashBoardInfo:function(t,o){var i=function(t,o){var e=r();e.method="GET",e.url=a+"/party/dashboard";var d=function(n){t(n.data)},s=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){i(t,o)})}):o()};n(e).then(d,s)};u(function(){i(t,o)})},loadAllUsers:function(t,o){var i=function(t,o){var e=r();e.method="GET",e.url=a+"/account";var d=function(n){t(n.data)},s=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){i(t,o)})}):o()};n(e).then(d,s)};u(function(){i(t,o)})},loadAllParties:function(t,o){var i=function(t,o){var e=r();e.method="GET",e.url=a+"/party";var d=function(n){t(n.data)},s=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){i(t,o)})}):o()};n(e).then(d,s)};u(function(){i(t,o)})},loadParty:function(t,o,i){var e=function(o,i){var d=r();d.method="GET",d.url=a+"/party/"+t;var s=function(n){o(n.data)},l=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){e(o,i)})}):i()};n(d).then(s,l)};u(function(){e(o,i)})},createParty:function(t,o,i){var e=function(o,i){var d=r();d.method="POST",d.url=a+"/party",d.data=t;var s=function(n){o(n.data)},l=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){e(o,i)})}):i()};n(d).then(s,l)};u(function(){e(o,i)})},generateKonfetti:function(t,o,i,e,d){var s=function(e,d){var l=r();l.method="GET",l.url=a+"/account/coupons-admin/"+t+"?count="+o+"&amount="+i;var p=function(n){e(n.data)},v=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){s(e,d)})}):d()};n(l).then(p,v)};u(function(){s(e,d)})},generateCodes:function(t,o,i,e,d){var s=function(e,d){var l=r();l.method="GET",l.url=a+"/account/codes-admin/"+t+"?count="+o+"&type="+i;var p=function(n){e(n.data)},v=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){s(e,d)})}):d()};n(l).then(p,v)};u(function(){s(e,d)})},updateParty:function(t,o,i){var e=function(o,i){var d=r();d.method="PUT",d.url=a+"/party",d.data=t;var s=function(n){o(n.data)},l=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){e(o,i)})}):i()};n(d).then(s,l)};u(function(){e(o,i)})},deleteParty:function(t,o,i){var e=function(o,i){var d=r();d.method="DELETE",d.url=a+"/party/"+t.id;var s=function(n){o()},l=function(n){f(n)?c("PASSWORD IS WRONG",function(){u(function(){e(o,i)})}):i()};n(d).then(s,l)};u(function(){e(o,i)})},modalAlert:function(n,t){c(n,t)},logout:function(){e=""}}}angular.module("RDash").factory("KonfettiApi",["$http","$uibModal",KonfettiApi]);